// Generated by CoffeeScript 1.6.2
(function() {
  var bg_colors, click_add_btn, click_delete, click_sort_btn, click_submit, click_toggle_details, delete_task, details_showing, high_els, highlight_col, init_add_btn, init_all, init_datepicker, init_delete_btns, init_details_display, init_sort, init_sort_btns, init_toggle_details_btn, low_els, on_error, set_details_btn_text, sort_by, sort_by_attr, sort_column, submit_success, unhighlight_col, unhighlight_task, update_tasks;

  bg_colors = {
    sort: 'LightSteelBlue',
    regular: 'White'
  };

  sort_column = 'priority';

  update_tasks = function(htmlStr, textStatus, jqXHR) {
    $('#tasks_container').html(htmlStr);
    highlight_col(sort_column);
    init_delete_btns();
    init_details_display();
    return init_datepicker();
  };

  sort_by_attr = function(attr_name) {
    return $.ajax({
      url: '/kaseres/tasks/',
      type: 'GET',
      data: {
        attr: attr_name
      },
      cache: false,
      dataType: 'html',
      success: update_tasks,
      error: function() {
        return on_error;
      }
    });
  };

  high_els = function(els) {
    return els.css('background-color', bg_colors.sort);
  };

  low_els = function(els) {
    return els.css('background-color', bg_colors.regular);
  };

  highlight_col = function(attr_name) {
    high_els($(".attr." + attr_name));
    return $("#sort_" + attr_name).prop('disabled', true);
  };

  unhighlight_col = function(attr_name) {
    return low_els($(".attr." + attr_name));
  };

  unhighlight_task = function(id) {
    return low_els($("#" + id + " ." + sort_column));
  };

  sort_by = function(attr_name) {
    sort_by_attr(attr_name);
    highlight_col(attr_name);
    return sort_column = attr_name;
  };

  click_sort_btn = function(evt) {
    var attr_name;

    $('.sort_btn').prop('disabled', false);
    unhighlight_col(sort_column);
    attr_name = this.id.match(/^sort_(.*)$/)[1];
    return sort_by(attr_name);
  };

  init_sort_btns = function() {
    return $('.sort_btn').click(click_sort_btn);
  };

  init_sort = function() {
    init_sort_btns();
    bg_colors.regular = $('.attr').css('background-color');
    return highlight_col(sort_column);
  };

  submit_success = function(htmlStr, textStatus, jqXHR) {
    console.log('success.  now add the DOM elements.');
    return console.log(htmlStr);
  };

  click_submit = function() {
    return $.ajax({
      type: 'POST',
      url: '/kaseres/tasks/create/',
      data: {
        title: 'my title',
        details: 'my details',
        due_date: new Date(),
        priority: 2
      },
      dataType: 'html',
      cache: false,
      error: on_error,
      success: submit_success
    });
  };

  click_add_btn = function() {
    alert('Open form for creating task.');
    return click_submit();
  };

  init_add_btn = function() {
    return $('#add_task').click(click_add_btn);
  };

  on_error = function(jqXHR, textStatus, errorThrown) {
    return console.log(errorThrown);
  };

  delete_task = function(id) {
    return $.ajax({
      type: 'DELETE',
      url: "/kaseres/tasks/" + id + "/delete/",
      cache: false,
      error: on_error,
      success: function() {
        return console.log('success!');
      }
    });
  };

  click_delete = function(evt) {
    var elem, task_id;

    if (!confirm('Delete this task?')) {
      return;
    }
    task_id = this.id.match(/^delete_(.*)$/)[1];
    elem = $("#task_" + task_id);
    elem.toggle(200, function() {
      return elem.remove();
    });
    return delete_task(task_id);
  };

  init_delete_btns = function() {
    return $('.delete_btn').click(click_delete);
  };

  details_showing = false;

  set_details_btn_text = function() {
    var verb;

    verb = details_showing ? 'Hide' : 'Show';
    return $('#toggle_details').html(verb + ' Details');
  };

  click_toggle_details = function(evt) {
    $('.task_details').toggle(200);
    details_showing = !details_showing;
    return set_details_btn_text();
  };

  init_details_display = function() {
    if (!details_showing) {
      return $('.task_details').toggle();
    }
  };

  init_toggle_details_btn = function() {
    $('#toggle_details').click(click_toggle_details);
    set_details_btn_text();
    return init_details_display();
  };

  init_datepicker = function() {
    return $('.date').datepicker({
      dateFormat: 'MM d, yy'
    });
  };

  init_all = function() {
    init_sort();
    init_toggle_details_btn();
    init_add_btn();
    init_delete_btns();
    return init_datepicker();
  };

  $(document).ready(init_all);

}).call(this);
